<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RecommendApp">

	<typeAlias alias="recommendApp" type="com.netease.flowgame.pojo.RecommendApp" />

	<sql id="selectAll">
		select id, name, icon_url as iconUrl, download_url as downloadUrl,
		recommend_time as recommendTime, app_id as appId, coin_amount as
		coinAmount, status, expire_time as expireTime, weight,position,
		size,price from recommend_app
	</sql>

	<insert id="insertRecommendApp" parameterClass="recommendApp">
		insert into recommend_app(id, name, icon_url, download_url,
        recommend_time, app_id, coin_amount, status, expire_time, weight,position,
        size,price)
		values(#id#, #name#, #iconUrl#, #downloadUrl#, #recommendTime#, #appId#,
		#coinAmount#, #status#, #expireTime#, #weight#, #position#,#size#,#price#)
	</insert>

	<select id="selectList" resultClass="recommendApp" parameterClass="java.util.Map">
		<include refid="selectAll" />
		<dynamic prepend="where">
			<isNotEmpty property="name" prepend="and">
				name like '%#name#%'
			</isNotEmpty>
            <isNotEmpty property="recommendTimeFrom" prepend="and">
                <![CDATA[recommend_time >= #recommendTimeFrom#]]>
            </isNotEmpty>
            <isNotEmpty property="recommendTimeTo" prepend="and">
                <![CDATA[recommend_time <= #recommendTimeTo#]]>
            </isNotEmpty>
            <isNotEmpty property="appId" prepend="and">
                app_id = #appId#
            </isNotEmpty>
            <isNotEmpty property="coinAmount" prepend="and">
                coin_amount = #coinAmount#
            </isNotEmpty>
            <isNotEmpty property="expireTimeFrom" prepend="and">
                <![CDATA[expire_time >= #expireTimeFrom#]]>
            </isNotEmpty>
            <isNotEmpty property="expireTimeTo" prepend="and">
                <![CDATA[expire_time <= #expireTimeTo#]]>
            </isNotEmpty>
            <isNotEmpty property="status" prepend="and">
                status = #status#
            </isNotEmpty>
            <isNotEmpty property="position" prepend="and">
                position = #position#
            </isNotEmpty>
		</dynamic>
        order by  $orderby$ $seq$
        <dynamic prepend="">
            <isNotEmpty property="size">
                limit 
                <isNotEmpty property="offset">
                    #offset#,
                </isNotEmpty>
                #size#
            </isNotEmpty>
        </dynamic>
	</select>

	<select id="selectByAppId" resultClass="recommendApp" parameterClass="java.lang.String">
		<include refid="selectAll" />
		where app_id = #appId#
	</select>
	
	<select id="selectLastTime" resultClass="java.util.Date" >
		select max(recommend_time) from recommend_app where status=0;
	</select>
	
	<update id="updateRecommendApp" parameterClass="recommendApp">
		update recommend_app set name = #name#, icon_url = #iconUrl#, download_url = #downloadUrl#,
        recommend_time as #recommendTime#, app_id as #appId#, coin_amount as #coinAmount#, 
        status = #status#, expire_time = #expireTime#, weight = #weight#, position=#position#,
        size=#size#, price=#price#         
		where id = #id#
	</update>

	<delete id="deleteRecommendApp" parameterClass="java.lang.Integer">
		delete recommend_app where id =	#id#
	</delete>
</sqlMap>